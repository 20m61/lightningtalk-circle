#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚¡ã‚¤ãƒ«
commit_msg_file=$1

if [ -z "$commit_msg_file" ]; then
  echo "âŒ Commit message file not provided"
  exit 1
fi

# ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿å–ã‚Š
commit_msg=$(cat "$commit_msg_file")

echo "ğŸ“ Validating commit message..."
echo "Message: $commit_msg"

# ç©ºã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯
if [ -z "$commit_msg" ] || [ "$commit_msg" = " " ]; then
  echo "âŒ Commit message cannot be empty"
  exit 1
fi

# ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ€å°é•·ã‚’ãƒã‚§ãƒƒã‚¯
if [ ${#commit_msg} -lt 10 ]; then
  echo "âŒ Commit message too short (minimum 10 characters)"
  echo "Current length: ${#commit_msg}"
  exit 1
fi

# æ¨å¥¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒã‚§ãƒƒã‚¯ï¼ˆConventional Commitsé¢¨ï¼‰
if echo "$commit_msg" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .+"; then
  echo "âœ… Commit message follows conventional format"
elif echo "$commit_msg" | grep -qE "^(ğŸ‰|ğŸ›|ğŸ“š|ğŸ’„|â™»ï¸|âœ…|ğŸ”§|âš¡|ğŸ‘·|ğŸ—ï¸|âª|ğŸ¯|ğŸš€|ğŸ”’|ğŸ“±|â™¿|ğŸŒ)"; then
  echo "âœ… Commit message uses emoji format"
elif echo "$commit_msg" | grep -qE "^(Add|Update|Fix|Remove|Refactor|Improve|Initial)"; then
  echo "âœ… Commit message follows standard format"
else
  echo "âš ï¸  Commit message format recommendation:"
  echo "  - Use conventional commits: feat: add new feature"
  echo "  - Use emojis: ğŸ‰ add new feature"
  echo "  - Use standard verbs: Add new feature"
  echo ""
  echo "ğŸ’¡ Examples:"
  echo "  feat: add user authentication"
  echo "  fix: resolve login validation issue"  
  echo "  ğŸ‰ add user authentication"
  echo "  ğŸ› fix login validation issue"
  echo "  Add user authentication"
  echo "  Fix login validation issue"
  echo ""
  echo "âš ï¸  This is a warning, not an error. Commit will proceed."
fi

# WIP ã‚³ãƒŸãƒƒãƒˆã®è­¦å‘Š
if echo "$commit_msg" | grep -qiE "(wip|work in progress|todo|fixme|hack)"; then
  echo "âš ï¸  Warning: This appears to be a work-in-progress commit"
  echo "Consider using a more descriptive message for production commits"
fi

# é•·ã™ãã‚‹ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è­¦å‘Š
if [ ${#commit_msg} -gt 72 ]; then
  echo "âš ï¸  Warning: Commit message is quite long (${#commit_msg} characters)"
  echo "Consider keeping the first line under 72 characters"
fi

# å¤§æ–‡å­—ã§å§‹ã¾ã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
first_char=$(echo "$commit_msg" | head -c 1)
if echo "$first_char" | grep -qE "[a-z]"; then
  echo "ğŸ’¡ Tip: Consider starting commit message with a capital letter"
fi

echo "âœ… Commit message validation passed"