import{r as a,a as x,j as t,c as d}from"./auth-Cj71Dr4d.js";import{B as h}from"./Modal-Bw8EuVDU.js";import{L as v}from"./LoginModal-CSz-kptF.js";import{E as b,P as j,a as k}from"./ParticipantCounter-s4-RaET7.js";const E=({onUserChange:i})=>{var p,g;const[e,n]=a.useState(null),[s,o]=a.useState(!1),[l,m]=a.useState(!1),[u,c]=a.useState(!1);a.useEffect(()=>{const r=x.getCurrentUser();n(r),i==null||i(r)},[i]);const f=r=>{n(r),i==null||i(r),o(!1)},w=()=>{x.signOut(),n(null),i==null||i(null),c(!1)},y=()=>{if(!e){o(!0);return}m(!0)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex items-center space-x-4",children:e?t.jsxs(t.Fragment,{children:[t.jsx(h,{variant:"secondary",size:"sm",onClick:y,icon:"✨",children:"イベント作成"}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>c(!u),className:"flex items-center space-x-2 text-sm bg-white rounded-full p-2 hover:bg-gray-50 transition-colors",children:[t.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-primary-500 to-secondary-500 rounded-full flex items-center justify-center text-white font-medium",children:((p=e.name)==null?void 0:p.charAt(0))||((g=e.email)==null?void 0:g.charAt(0))||"?"}),t.jsx("span",{className:"hidden md:block font-medium text-gray-700",children:e.name||e.email}),t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&t.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[t.jsxs("div",{className:"px-4 py-2 border-b border-gray-100",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsx("p",{className:"text-xs text-gray-500",children:e.email})]}),t.jsx("button",{onClick:()=>{m(!0),c(!1)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"✨ イベント作成"}),t.jsx("button",{onClick:()=>{window.location.href="/speaker-dashboard.html"},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"📊 ダッシュボード"}),t.jsx("div",{className:"border-t border-gray-100 mt-1 pt-1",children:t.jsx("button",{onClick:w,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"🚪 ログアウト"})})]})]})]}):t.jsx(h,{variant:"primary",size:"sm",onClick:()=>o(!0),icon:"🔑",children:"ログイン"})}),t.jsx(v,{isOpen:s,onClose:()=>o(!1),onSuccess:f}),t.jsx(b,{isOpen:l,onClose:()=>m(!1)}),u&&t.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)})]})};class C{constructor(){this.isInitialized=!1,this.modals={registration:null}}init(){if(!this.isInitialized)try{this.initAuthHeader(),this.initRegistrationButton(),this.initParticipantCounter(),this.isInitialized=!0,console.log("Lightning Talk React components initialized")}catch(e){console.error("Failed to initialize React components:",e)}}initAuthHeader(){const e=document.getElementById("auth-header");if(!e)return;d.createRoot(e).render(t.jsx(E,{onUserChange:s=>{console.log("User state changed:",s),this.handleUserStateChange(s)}}))}initRegistrationButton(){const e=document.getElementById("registration-button");if(!e)return;d.createRoot(e).render(t.jsx(h,{variant:"primary",size:"lg",icon:"📝",onClick:()=>this.showRegistrationModal(),className:"w-full",children:"当日参加申込み"}))}initParticipantCounter(){const e=document.getElementById("participant-counter");if(!e)return;d.createRoot(e).render(t.jsx(j,{eventId:"event-001",showAnimation:!0}))}showRegistrationModal(){let e=document.getElementById("react-registration-modal");e||(e=document.createElement("div"),e.id="react-registration-modal",document.body.appendChild(e)),d.createRoot(e).render(t.jsx(k,{isOpen:!0,onClose:()=>{e&&e.remove()},onSubmit:async s=>{var o;try{if(console.log("Registration submitted:",s),(await fetch("/api/participants",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((o=document.querySelector('[name="_csrf"]'))==null?void 0:o.value)||""},body:JSON.stringify({...s,eventId:"event-001"})})).ok)this.showSuccessMessage("参加申込みが完了しました！"),this.refreshParticipantCounter();else throw new Error("Registration failed")}catch(l){console.error("Registration error:",l),this.showErrorMessage("申込みに失敗しました。もう一度お試しください。")}}}))}showSuccessMessage(e){const n=document.createElement("div");n.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50",n.innerHTML=`
      <div class="flex items-center space-x-2">
        <span class="text-xl">✅</span>
        <span>${e}</span>
      </div>
    `,document.body.appendChild(n),setTimeout(()=>{n.remove()},5e3)}showErrorMessage(e){const n=document.createElement("div");n.className="fixed top-4 right-4 bg-red-500 text-white px-6 py-4 rounded-lg shadow-lg z-50",n.innerHTML=`
      <div class="flex items-center space-x-2">
        <span class="text-xl">❌</span>
        <span>${e}</span>
      </div>
    `,document.body.appendChild(n),setTimeout(()=>{n.remove()},5e3)}refreshParticipantCounter(){document.getElementById("participant-counter")&&this.initParticipantCounter()}handleUserStateChange(e){e?console.log("User authenticated:",e.name||e.email):console.log("User logged out")}}window.LightningTalk=new C;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.LightningTalk.init()}):window.LightningTalk.init();
