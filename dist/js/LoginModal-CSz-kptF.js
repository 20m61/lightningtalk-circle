import{r as o,j as e,a as d}from"./auth-Cj71Dr4d.js";import{M as I,B as c}from"./Modal-Bw8EuVDU.js";const M=({isOpen:v,onClose:u,onSuccess:l})=>{const[t,g]=o.useState("signin"),[x,m]=o.useState(!1),[r,h]=o.useState({email:"",password:"",fullName:"",confirmPassword:"",verificationCode:""}),[y,p]=o.useState("form"),[f,a]=o.useState(""),n=i=>{h(s=>({...s,[i.target.name]:i.target.value})),f&&a("")},w=async i=>{i.preventDefault(),m(!0),a("");try{if(t==="signup"){if(r.password!==r.confirmPassword){a("パスワードが一致しません");return}const s=await d.signUp(r.email,r.password,r.fullName);s.success?p("verify"):a(s.error||"アカウント作成に失敗しました")}else{const s=await d.signIn(r.email,r.password);s.success?(l==null||l(s.user),u()):a(s.error||"ログインに失敗しました")}}catch{a("エラーが発生しました。もう一度お試しください。")}finally{m(!1)}},N=async i=>{i.preventDefault(),m(!0),a("");try{const s=await d.confirmSignUp(r.email,r.verificationCode);if(s.success){const j=await d.signIn(r.email,r.password);j.success?(l==null||l(j.user),u()):(g("signin"),p("form"),a("アカウントが確認されました。ログインしてください。"))}else a(s.error||"確認コードが無効です")}catch{a("確認に失敗しました。もう一度お試しください。")}finally{m(!1)}},b=i=>{try{i==="google"?d.googleSignIn():i==="apple"&&a("Apple Sign-Inは現在準備中です")}catch{a("ソーシャルログインでエラーが発生しました")}},C=()=>{h({email:"",password:"",fullName:"",confirmPassword:"",verificationCode:""}),p("form"),a("")},k=()=>{g(t==="signin"?"signup":"signin"),C()};return e.jsx(I,{isOpen:v,onClose:u,title:y==="verify"?"メール確認":t==="signin"?"ログイン":"アカウント作成",size:"md",children:e.jsxs("div",{className:"space-y-6",children:[f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-600",children:f})}),y==="verify"?e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:[r.email," に確認コードを送信しました。",e.jsx("br",{}),"メールをご確認ください。"]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"確認コード"}),e.jsx("input",{type:"text",name:"verificationCode",value:r.verificationCode,onChange:n,required:!0,className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"123456"})]}),e.jsx(c,{type:"submit",variant:"primary",fullWidth:!0,loading:x,children:"確認する"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[t==="signup"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"お名前"}),e.jsx("input",{type:"text",name:"fullName",value:r.fullName,onChange:n,required:!0,className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"山田 太郎"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メールアドレス"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:n,required:!0,className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"example@domain.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"パスワード"}),e.jsx("input",{type:"password",name:"password",value:r.password,onChange:n,required:!0,className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"8文字以上"})]}),t==="signup"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"パスワード確認"}),e.jsx("input",{type:"password",name:"confirmPassword",value:r.confirmPassword,onChange:n,required:!0,className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500",placeholder:"パスワードを再入力"})]}),e.jsx(c,{type:"submit",variant:"primary",fullWidth:!0,loading:x,children:t==="signin"?"ログイン":"アカウント作成"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"または"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{type:"button",variant:"outline",fullWidth:!0,onClick:()=>b("google"),icon:"🌐",children:"Googleでログイン"}),e.jsx(c,{type:"button",variant:"outline",fullWidth:!0,onClick:()=>b("apple"),icon:"🍎",children:"Appleでログイン"})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:k,className:"text-sm text-primary-600 hover:text-primary-700",children:t==="signin"?"アカウントをお持ちでない方はこちら":"すでにアカウントをお持ちの方はこちら"})})]})]})})};export{M as L};
