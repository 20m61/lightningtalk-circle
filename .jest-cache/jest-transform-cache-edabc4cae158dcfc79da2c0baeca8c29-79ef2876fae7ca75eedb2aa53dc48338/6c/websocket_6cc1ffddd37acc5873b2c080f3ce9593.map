{"version":3,"names":["cov_2lo15ry8oj","actualCoverage","WebSocketServer","logger","notificationService","setupWebSocketServer","server","f","wss","s","path","clientTracking","info","setupWebSocket","on","ws","request","clientIP","socket","remoteAddress","error","setInterval","stats","getConnectionStats","wsClients"],"sources":["websocket.js"],"sourcesContent":["/**\n * WebSocket Server Setup\n * WebSocketサーバーの設定とNotificationServiceとの統合\n */\n\nimport { WebSocketServer } from 'ws';\nimport { logger } from './middleware/logger.js';\nimport notificationService from './services/notificationService.js';\n\n/**\n * WebSocketサーバーの設定\n */\nexport function setupWebSocketServer(server) {\n  const wss = new WebSocketServer({ \n    server,\n    path: '/ws',\n    clientTracking: true\n  });\n\n  logger.info('WebSocket server initialized');\n\n  // NotificationServiceにWebSocketサーバーを設定\n  notificationService.setupWebSocket(wss);\n\n  // WebSocketサーバーイベント\n  wss.on('connection', (ws, request) => {\n    const clientIP = request.socket.remoteAddress;\n    logger.info(`WebSocket connection from ${clientIP}`);\n\n    ws.on('error', (error) => {\n      logger.error(`WebSocket error from ${clientIP}:`, error);\n    });\n  });\n\n  wss.on('close', () => {\n    logger.info('WebSocket server closed');\n  });\n\n  wss.on('error', (error) => {\n    logger.error('WebSocket server error:', error);\n  });\n\n  // サーバー統計の定期ログ出力\n  setInterval(() => {\n    const stats = notificationService.getConnectionStats();\n    logger.info(`WebSocket stats: ${stats.wsClients} connected clients`);\n  }, 60000); // 1分ごと\n\n  return wss;\n}"],"mappings":"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","ignoreList":[]}