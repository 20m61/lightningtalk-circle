c4cca9ed28fa7c80b091d2117a9b68b0
/* istanbul ignore next */
function cov_2004zaq7y6() {
  var path = "/home/ec2-user/workspace/lightningtalk-circle/server/middleware/errorHandler.js";
  var hash = "935e7a58fb6c064d0c410fe8127cea5cdbeca700";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/ec2-user/workspace/lightningtalk-circle/server/middleware/errorHandler.js",
    statementMap: {
      "0": {
        start: {
          line: 5,
          column: 28
        },
        end: {
          line: 35,
          column: 1
        }
      },
      "1": {
        start: {
          line: 6,
          column: 16
        },
        end: {
          line: 6,
          column: 26
        }
      },
      "2": {
        start: {
          line: 7,
          column: 4
        },
        end: {
          line: 7,
          column: 32
        }
      },
      "3": {
        start: {
          line: 10,
          column: 4
        },
        end: {
          line: 10,
          column: 23
        }
      },
      "4": {
        start: {
          line: 13,
          column: 4
        },
        end: {
          line: 16,
          column: 5
        }
      },
      "5": {
        start: {
          line: 14,
          column: 24
        },
        end: {
          line: 14,
          column: 44
        }
      },
      "6": {
        start: {
          line: 15,
          column: 8
        },
        end: {
          line: 15,
          column: 41
        }
      },
      "7": {
        start: {
          line: 19,
          column: 4
        },
        end: {
          line: 22,
          column: 5
        }
      },
      "8": {
        start: {
          line: 20,
          column: 24
        },
        end: {
          line: 20,
          column: 55
        }
      },
      "9": {
        start: {
          line: 21,
          column: 8
        },
        end: {
          line: 21,
          column: 41
        }
      },
      "10": {
        start: {
          line: 25,
          column: 4
        },
        end: {
          line: 28,
          column: 5
        }
      },
      "11": {
        start: {
          line: 26,
          column: 24
        },
        end: {
          line: 26,
          column: 73
        }
      },
      "12": {
        start: {
          line: 26,
          column: 61
        },
        end: {
          line: 26,
          column: 72
        }
      },
      "13": {
        start: {
          line: 27,
          column: 8
        },
        end: {
          line: 27,
          column: 41
        }
      },
      "14": {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 34,
          column: 7
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 5,
            column: 28
          },
          end: {
            line: 5,
            column: 29
          }
        },
        loc: {
          start: {
            line: 5,
            column: 53
          },
          end: {
            line: 35,
            column: 1
          }
        },
        line: 5
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 26,
            column: 54
          },
          end: {
            line: 26,
            column: 55
          }
        },
        loc: {
          start: {
            line: 26,
            column: 61
          },
          end: {
            line: 26,
            column: 72
          }
        },
        line: 26
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 13,
            column: 4
          },
          end: {
            line: 16,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 13,
            column: 4
          },
          end: {
            line: 16,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 13
      },
      "1": {
        loc: {
          start: {
            line: 19,
            column: 4
          },
          end: {
            line: 22,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 19,
            column: 4
          },
          end: {
            line: 22,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 19
      },
      "2": {
        loc: {
          start: {
            line: 25,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 25,
            column: 4
          },
          end: {
            line: 28,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 25
      },
      "3": {
        loc: {
          start: {
            line: 30,
            column: 15
          },
          end: {
            line: 30,
            column: 34
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 30,
            column: 15
          },
          end: {
            line: 30,
            column: 27
          }
        }, {
          start: {
            line: 30,
            column: 31
          },
          end: {
            line: 30,
            column: 34
          }
        }],
        line: 30
      },
      "4": {
        loc: {
          start: {
            line: 32,
            column: 15
          },
          end: {
            line: 32,
            column: 46
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 32,
            column: 15
          },
          end: {
            line: 32,
            column: 28
          }
        }, {
          start: {
            line: 32,
            column: 32
          },
          end: {
            line: 32,
            column: 46
          }
        }],
        line: 32
      },
      "5": {
        loc: {
          start: {
            line: 33,
            column: 12
          },
          end: {
            line: 33,
            column: 74
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 33,
            column: 12
          },
          end: {
            line: 33,
            column: 50
          }
        }, {
          start: {
            line: 33,
            column: 54
          },
          end: {
            line: 33,
            column: 74
          }
        }],
        line: 33
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0
    },
    f: {
      "0": 0,
      "1": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0]
    },
    inputSourceMap: null,
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "935e7a58fb6c064d0c410fe8127cea5cdbeca700"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_2004zaq7y6 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_2004zaq7y6();
cov_2004zaq7y6().s[0]++;
/**
 * Error handling middleware
 */

export const errorHandler = (err, req, res, next) => {
  /* istanbul ignore next */
  cov_2004zaq7y6().f[0]++;
  let error =
  /* istanbul ignore next */
  (cov_2004zaq7y6().s[1]++, {
    ...err
  });
  /* istanbul ignore next */
  cov_2004zaq7y6().s[2]++;
  error.message = err.message;

  // Log error
  /* istanbul ignore next */
  cov_2004zaq7y6().s[3]++;
  console.error(err);

  // Mongoose bad ObjectId
  /* istanbul ignore next */
  cov_2004zaq7y6().s[4]++;
  if (err.name === 'CastError') {
    /* istanbul ignore next */
    cov_2004zaq7y6().b[0][0]++;
    const message =
    /* istanbul ignore next */
    (cov_2004zaq7y6().s[5]++, 'Resource not found');
    /* istanbul ignore next */
    cov_2004zaq7y6().s[6]++;
    error = {
      message,
      status: 404
    };
  } else
  /* istanbul ignore next */
  {
    cov_2004zaq7y6().b[0][1]++;
  }

  // Mongoose duplicate key
  cov_2004zaq7y6().s[7]++;
  if (err.code === 11000) {
    /* istanbul ignore next */
    cov_2004zaq7y6().b[1][0]++;
    const message =
    /* istanbul ignore next */
    (cov_2004zaq7y6().s[8]++, 'Duplicate field value entered');
    /* istanbul ignore next */
    cov_2004zaq7y6().s[9]++;
    error = {
      message,
      status: 400
    };
  } else
  /* istanbul ignore next */
  {
    cov_2004zaq7y6().b[1][1]++;
  }

  // Mongoose validation error
  cov_2004zaq7y6().s[10]++;
  if (err.name === 'ValidationError') {
    /* istanbul ignore next */
    cov_2004zaq7y6().b[2][0]++;
    const message =
    /* istanbul ignore next */
    (cov_2004zaq7y6().s[11]++, Object.values(err.errors).map(val => {
      /* istanbul ignore next */
      cov_2004zaq7y6().f[1]++;
      cov_2004zaq7y6().s[12]++;
      return val.message;
    }));
    /* istanbul ignore next */
    cov_2004zaq7y6().s[13]++;
    error = {
      message,
      status: 400
    };
  } else
  /* istanbul ignore next */
  {
    cov_2004zaq7y6().b[2][1]++;
  }
  cov_2004zaq7y6().s[14]++;
  res.status(
  /* istanbul ignore next */
  (cov_2004zaq7y6().b[3][0]++, error.status) ||
  /* istanbul ignore next */
  (cov_2004zaq7y6().b[3][1]++, 500)).json({
    success: false,
    error:
    /* istanbul ignore next */
    (cov_2004zaq7y6().b[4][0]++, error.message) ||
    /* istanbul ignore next */
    (cov_2004zaq7y6().b[4][1]++, 'Server Error'),
    ...(
    /* istanbul ignore next */
    (cov_2004zaq7y6().b[5][0]++, process.env.NODE_ENV === 'development') &&
    /* istanbul ignore next */
    (cov_2004zaq7y6().b[5][1]++, {
      stack: err.stack
    }))
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjAwNHphcTd5NiIsImFjdHVhbENvdmVyYWdlIiwicyIsImVycm9ySGFuZGxlciIsImVyciIsInJlcSIsInJlcyIsIm5leHQiLCJmIiwiZXJyb3IiLCJtZXNzYWdlIiwiY29uc29sZSIsIm5hbWUiLCJiIiwic3RhdHVzIiwiY29kZSIsIk9iamVjdCIsInZhbHVlcyIsImVycm9ycyIsIm1hcCIsInZhbCIsImpzb24iLCJzdWNjZXNzIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic3RhY2siXSwic291cmNlcyI6WyJlcnJvckhhbmRsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBFcnJvciBoYW5kbGluZyBtaWRkbGV3YXJlXG4gKi9cblxuZXhwb3J0IGNvbnN0IGVycm9ySGFuZGxlciA9IChlcnIsIHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgbGV0IGVycm9yID0geyAuLi5lcnIgfTtcbiAgICBlcnJvci5tZXNzYWdlID0gZXJyLm1lc3NhZ2U7XG5cbiAgICAvLyBMb2cgZXJyb3JcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG5cbiAgICAvLyBNb25nb29zZSBiYWQgT2JqZWN0SWRcbiAgICBpZiAoZXJyLm5hbWUgPT09ICdDYXN0RXJyb3InKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSAnUmVzb3VyY2Ugbm90IGZvdW5kJztcbiAgICAgICAgZXJyb3IgPSB7IG1lc3NhZ2UsIHN0YXR1czogNDA0IH07XG4gICAgfVxuXG4gICAgLy8gTW9uZ29vc2UgZHVwbGljYXRlIGtleVxuICAgIGlmIChlcnIuY29kZSA9PT0gMTEwMDApIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9ICdEdXBsaWNhdGUgZmllbGQgdmFsdWUgZW50ZXJlZCc7XG4gICAgICAgIGVycm9yID0geyBtZXNzYWdlLCBzdGF0dXM6IDQwMCB9O1xuICAgIH1cblxuICAgIC8vIE1vbmdvb3NlIHZhbGlkYXRpb24gZXJyb3JcbiAgICBpZiAoZXJyLm5hbWUgPT09ICdWYWxpZGF0aW9uRXJyb3InKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBPYmplY3QudmFsdWVzKGVyci5lcnJvcnMpLm1hcCh2YWwgPT4gdmFsLm1lc3NhZ2UpO1xuICAgICAgICBlcnJvciA9IHsgbWVzc2FnZSwgc3RhdHVzOiA0MDAgfTtcbiAgICB9XG5cbiAgICByZXMuc3RhdHVzKGVycm9yLnN0YXR1cyB8fCA1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ1NlcnZlciBFcnJvcicsXG4gICAgICAgIC4uLihwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyAmJiB7IHN0YWNrOiBlcnIuc3RhY2sgfSlcbiAgICB9KTtcbn07Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQWVZO0lBQUFBLGNBQUEsWUFBQUEsQ0FBQTtNQUFBLE9BQUFDLGNBQUE7SUFBQTtFQUFBO0VBQUEsT0FBQUEsY0FBQTtBQUFBO0FBQUFE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